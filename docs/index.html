<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>営業時間表</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: auto;
        }

        #dateSelect {
            margin-bottom: 20px;
        }

        #openingHours {
            margin-top: 20px;
        }

        .campus-table {
            margin-bottom: 30px;
        }

        .campus-table h4 {
            border-left: 5px solid #007bff;
            /* キャンパス名の強調 */
            padding-left: 10px;
            margin-bottom: 20px;
        }

        .table th {
            background-color: #f8f9fa;
            /* ヘッダーの背景色 */
        }

        .table td,
        .table th {
            padding: 12px;
            /* セルの余白調整 */
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>営業時間表</h1>
        <label for="dateSelect">日付選択:</label>
        <input type="date" id="dateSelect">
        <div id="openingHours">
            <!-- 営業時間がここに表示されます -->
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script>
        // JSONデータのURL
        const jsonDataUrl = 'https://raw.githubusercontent.com/Kotetsu0000/SIT_Coop_data/main/data/coop_data.json';

        // ページ読み込み時に実行する関数
        window.onload = async function () {
            const dateSelect = document.getElementById('dateSelect');
            const openingHoursDiv = document.getElementById('openingHours');

            // 日付選択時のイベントリスナー
            dateSelect.addEventListener('change', async function () {
                const selectedDate = dateSelect.value;
                const data = await fetchJsonData(jsonDataUrl);
                displayOpeningHours(data, selectedDate, openingHoursDiv);
            });

            try {
                // JSONデータを取得
                const data = await fetchJsonData(jsonDataUrl);

                // ページ読み込み時に初期データを表示する（例えば今日の日付）
                const today = new Date()
                const options = { timeZone: 'Asia/Tokyo' };
                const jpToday = today.toLocaleString('ja-JP', options).split(' ')[0];
                const jpToday_list = jpToday.split('/');
                const year = jpToday_list[0];
                const month = jpToday_list[1].padStart(2, '0');;
                const day = jpToday_list[2].padStart(2, '0');;
                const selectedDate = `${year}-${month}-${day}`
                displayOpeningHours(data, selectedDate, openingHoursDiv);
            } catch (error) {
                console.error('エラー:', error);
                openingHoursDiv.innerHTML = `<p>データを取得できませんでした。</p>`;
            }
        };

        // JSONデータを取得する関数
        async function fetchJsonData(url) {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error('データを取得できませんでした。');
            }
            return await response.json();
        }

        // 選択された日付の営業時間を表示する関数
        function displayOpeningHours(data, selectedDate, openingHoursDiv) {
            const formattedDate = formatDate(selectedDate);
            const selectedData = data[formattedDate];
            const campusMap = {
                'shop_self': { 'name': 'ショップ セルフ', 'campus': 'toyosu' },
                'shop_counter': { 'name': 'ショップ カウンター', 'campus': 'toyosu' },
                'cafeteria': { 'name': 'カフェテリア', 'campus': 'toyosu' },
                'coop_plaza_self': { 'name': 'コーププラザ セルフ', 'campus': 'omiya' },
                'coop_plaza_counter': { 'name': 'コーププラザ カウンター', 'campus': 'omiya' },
                'dining_hall': { 'name': '食堂', 'campus': 'omiya' },
                'shibaura_bakery': { 'name': '芝浦ベーカリー(大学会館1階)', 'campus': 'omiya' },
                'office': { 'name': '事務室', 'campus': 'omiya' },
                'realtor': { 'name': 'お部屋探し', 'campus': 'omiya' }
            };
            const weekdayMap = {
                "Saturday": "土",
                "Sunday": "日",
                "Monday": "月",
                "Tuesday": "火",
                "Wednesday": "水",
                "Thursday": "木",
                "Friday": "金"
            };

            if (selectedData) {
                let html = `<h3>${selectedDate.replace(/-/g, '/')} (${weekdayMap[selectedData.week_day]}) の営業時間</h3>`;

                // キャンパスごとに情報を表示
                html += '<div class="col-md-12">'; // col-md-6で横に並べる
                ['omiya', 'toyosu'].forEach(campus => {
                    let campusData = '';
                    for (const key in selectedData) {
                        if (key !== 'week_day' && campusMap[key] && campusMap[key].campus === campus) {
                            campusData += `<tr><td>${campusMap[key].name}</td><td>${selectedData[key]}</td></tr>`;
                        }
                    }
                    if (campusData !== '') {
                        html += `<div class="campus-table"><h4>${campus === 'toyosu' ? '豊洲キャンパス' : '大宮キャンパス'}</h4>`;
                        html += '<table class="table">';
                        html += '<thead><tr><th class="col-md-6">店舗/施設</th><th class="col-md-6">営業時間</th></tr></thead>';
                        html += '<tbody>';
                        html += campusData;
                        html += '</tbody></table></div>';
                    }
                });
                html += '</div>'; // col-md-6の閉じタグ

                openingHoursDiv.innerHTML = html;
            } else {
                openingHoursDiv.innerHTML = `<p>${selectedDate.replace(/_/g, '/')} のデータはありません。</p>`;
            }
        }

        // 日付をJSONデータのフォーマットに合わせる関数
        function formatDate(dateString) {
            const [year, month, day] = dateString.split('-');
            return `${year}_${month}_${day}`;
        }
    </script>
</body>

</html>